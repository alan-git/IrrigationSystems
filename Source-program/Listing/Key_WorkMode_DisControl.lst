C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/25/2018 21:11:18 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE KEY_WORKMODE_DISCONTROL
OBJECT MODULE PLACED IN ..\Output\Key_WorkMode_DisControl.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\Code\DeveloperCode\Key_WorkMode_DisControl.C BROWSE INCDIR(..\Code\Devel
                    -operCode\inc;..\Code\DirverCode\inc;..\Code\Public\inc) DEBUG OBJECTEXTEND PRINT(..\Listing\Key_WorkMode_DisControl.lst)
                    - OBJECT(..\Output\Key_WorkMode_DisControl.obj)

line level    source

   1          
   2          #include "Key_WorkMode_DisControl.H"
   3          
   4          bit sS1 = 0, sS2 = 0;   //°´¼üÊÇ·ñÓÐ¹ý°´ÏÂ¶¯×÷£»
   5          enum {
   6              noKey,              //ÎÞ°´¼üÊÂ¼þ£»
   7              combS1,             //ÒÔS1Ö÷°´¼üµÄ°´¼ü×éºÏÊÂ¼þ£»£¨Ö÷°´¼ü¼´±£³Ö°´ÏÂµÄ°´¼ü£©
   8              combS2,             //ÒÔS2Ö÷°´¼üµÄ°´¼ü×éºÏÊÂ¼þ£»
   9              disCombS1,          //·Ç×éºÏS1°´ÏÂÊÂ¼þ£»
  10              disCombS2,          //·Ç×éºÏS2°´ÏÂÊÂ¼þ£»
  11          }combHappened = noKey;  //°´¼ü×éºÏÊÂ¼þ·¢Éú´¦ÀíºóÖÃnoKey£»
  12          
  13          enum {
  14              autoControl,        //×Ô¶¯Ä£Ê½£»
  15              manualControl,      //ÊÖ¶¯Ä£Ê½£»
  16              adjustSec,          //µ÷½ÚÃë£»
  17              adjustMin,          //µ÷½Ú·Ö£»
  18              adjustHour,         //µ÷½ÚÊ±£»
  19              adjustHumidLimit,   //µ÷½ÚÊª¶ÈãÐÖµ£»
  20          }workMode = autoControl;//¹¤×÷Ä£Ê½Ä¬ÈÏÎª×Ô¶¯£»
  21          
  22          extern void checkPressKey();   //°´¼ü°´ÏÂ¼ì²â;
  23          extern void checkCombKey();    //°´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
  24          extern void checkOrdinaryKey();//ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
  25          extern void keyCheckOver();    //°´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
  26          
  27          /* *******************************************************************************************
  28          // ×Ô¶¯Ä£Ê½ÏÂÊª¶È¹ýµÍ×Ô¶¯¿ªÆôRelay£º
  29          /* ******************************************************************************************* */
  30          void AutoRelayControl()
  31          {
  32   1          if (workMode == autoControl)
  33   1          {
  34   2              if (Humidity <= HumidLimit)     //µ±Ç°Êª¶ÈÐ¡ÓÚÊª¶ÈãÐÖµ£»
  35   2              {
  36   3                  PIN_ConRelay = RELAY_ON;
  37   3              }
  38   2              else 
  39   2              {
  40   3                  PIN_ConRelay = RELAY_OFF;
  41   3              }
  42   2          }                                   //Relay´ò¿ª×´Ì¬ÇÐ»»Ä£Ê½Relay×Ô¶¯¹Ø±ÕµÄÓï¾äÔÚ°´¼üÏìÓ¦²¿·Ö£»  
  43   1      }
  44          
  45          /* *******************************************************************************************
  46          // ·Ç×Ô¶¯Ä£Ê½ÏÂÊª¶È¹ýµÍ·¢³ö¾¯±¨£º
  47          /* ******************************************************************************************* */
  48          void BuzzerControl()
  49          {
  50   1          if (workMode != autoControl)        //Ç°Ìá£º·Ç×Ô¶¯Ä£Ê½£»
  51   1          {
  52   2      //        TestCode();
  53   2              if (Humidity < HumidLimit)      //µ±Ç°Êª¶ÈÐ¡ÓÚÊª¶ÈãÐÖµ£»
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/25/2018 21:11:18 PAGE 2   

  54   2              {
  55   3      //            TestCode();
  56   3                  if (PIN_ConRelay == RELAY_OFF)  //Ë®±ÃÎ´¿ªÆô£»
  57   3                  {
  58   4                      Buzzer_On();
  59   4                  }
  60   3                  else
  61   3                  {
  62   4                      Buzzer_Off();
  63   4                  }
  64   3              }
  65   2              else 
  66   2              {
  67   3                  Buzzer_Off();
  68   3              }
  69   2          }
  70   1          else
  71   1          {
  72   2              Buzzer_Off();
  73   2          } 
  74   1      }
  75          /* *******************************************************************************************
  76          // ÏÔÊ¾¿ØÖÆ
  77          /* ******************************************************************************************* */
  78          void DisControl()
  79          {
  80   1          switch (workMode)
  81   1          {
  82   2              case autoControl:   Dis_Auto_not_ManualMode(TRUE);
  83   2                  break;
  84   2              case manualControl: Dis_Auto_not_ManualMode(FALSE);//TestCode(); 
  85   2                  break;
  86   2              case adjustSec:     AdjustmentDataDis(SEC, Sec);
  87   2                  break;
  88   2              case adjustMin:     AdjustmentDataDis(MIN, Min);
  89   2                  break;
  90   2              case adjustHour:    AdjustmentDataDis(HOUR, Hour);
  91   2                  break;
  92   2              case adjustHumidLimit:AdjustmentDataDis(HUMIDLIMIT, HumidLimit);
  93   2                  break;
  94   2              default:
  95   2                  break;
  96   2          }
  97   1      //    #ifdef DeveloperMode
  98   1      //        DelayMS(200);       //Ïû³ý·ÂÕæÉÁË¸£¨¼õÐ¡ÇåÆÁÕ¼¿Õ£©£»
  99   1      //    #else
 100   1      //        DelayMS(50);        //Ïû³ýÊµÎïÉÁË¸£¨¼õÐ¡ÇåÆÁÕ¼¿Õ£©£»
 101   1      //    #endif
 102   1      }
 103          
 104          /* *******************************************************************************************
 105          // °´¼üÏìÓ¦
 106          /* ******************************************************************************************* */
 107          void KeyResponse()
 108          {
 109   1          checkPressKey();    //°´¼ü°´ÏÂ¼ì²â;
 110   1          checkCombKey();     //°´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
 111   1          checkOrdinaryKey(); //ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
 112   1          keyCheckOver();     //°´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
 113   1      }
 114          
 115          /* *******************************************************************************************
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/25/2018 21:11:18 PAGE 3   

 116          // °´¼ü°´ÏÂ¼ì²â
 117          /* ******************************************************************************************* */
 118          static void checkPressKey()
 119          {
 120   1          if (!PIN_S1 && !sS1)    //°´¼üS1²»ÊÇ³ÖÐø°´ÏÂ£¨°´¼ü°´ÏÂµÄÒ»Ë²¼äÖ´ÐÐ£¬³ÖÐø°´ÏÂ²»»áÔÙÖ´ÐÐÏû¶¶£©£»
 121   1          {
 122   2              DelayMS(10);
 123   2              if (!PIN_S1)
 124   2              {
 125   3                  sS1 = 1;        //È·ÈÏ°´¼ü°´ÏÂ£»
 126   3              }
 127   2          }
 128   1          if (!PIN_S2 && !sS2)
 129   1          {
 130   2              DelayMS(10);
 131   2              if (!PIN_S2)
 132   2              {
 133   3                  sS2 = 1;        //È·ÈÏ°´¼ü°´ÏÂ£»  
 134   3              }
 135   2          }
 136   1      }
 137          
 138          /* *******************************************************************************************
 139          // °´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
 140          /* ******************************************************************************************* */
 141          /* ******************************************************************************************* 
 142          /* °´¼ü×´Ì¬Çî¾Ù£º
 143          /*  Ò»¡¢»ù´¡£º
 144                  1. S1°´ÏÂºóÌ§Æð£¬S2ÎÞ¶¯×÷£»
 145                  2. S2°´ÏÂºóÌ§Æð£¬S1ÎÞ¶¯×÷£»
 146              ¶þ¡¢×éºÏ£º
 147                  1. S1°´ÏÂ±£³Ö£¬S2·´¸´°´ÏÂ£»
 148                  2. S2°´ÏÂ±£³Ö£¬S1·´¸´°´ÏÂ£»
 149          ÉÏ·½ËÄÖÖÊÇÎÒÃÇÐèÒªµÄ£¬Ê¶±ðºóµ÷ÓÃ¹¦ÄÜº¯Êý
 150          ÏÂ·½ËÄÖÖ(ºÜ¶àÖÖ)²»ÐèÒª£¬Ê¶±ðºóÂËÈ¥£»
 151                  3. S1°´ÏÂ£¬S2°´ÏÂ£¬S1Ì§Æð£¬S2Ì§Æð£»
 152                  4. S2°´ÏÂ£¬S1°´ÏÂ£¬S2Ì§Æð£¬S1Ì§Æð£»
 153                  5. S1°´ÏÂ£¬S2°´ÏÂ±£³Ö£¬S1·´¸´Ì§Æð°´ÏÂ£»
 154                  6. S2°´ÏÂ£¬S1°´ÏÂ±£³Ö£¬S2·´¸´Ì§Æð°´ÏÂ£»
 155          /* ******************************************************************************************* */
 156          static void checkCombKey()
 157          {
 158   1          if (!PIN_S1)            //¼´Ä¿Ç°S1´¦ÓÚ°´ÏÂ×´Ì¬£»
 159   1          {
 160   2              if (sS2 && PIN_S2)  //S2°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 161   2              {
 162   3      //            sS2 = 0;//¸´Î»Î»ÖÃ´íÎó£¬ÒÑÐÞ¸Ä£»
 163   3                  combHappened = combS1;
 164   3              }
 165   2          }
 166   1          if (!PIN_S2)            //¼´Ä¿Ç°S2´¦ÓÚ°´ÏÂ×´Ì¬£»
 167   1          {
 168   2              if (sS1 && PIN_S1)  //S1°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 169   2              {
 170   3      //            sS1 = 0;//¸´Î»Î»ÖÃ´íÎó£¬ÒÑÐÞ¸Ä£»
 171   3                  combHappened = combS2;
 172   3              }
 173   2          }
 174   1      // ÏÂ·½º¯Êý²»ÄÜÓëÉÏ·½º¯ÊýÎ»ÖÃ¶Ôµ÷£»
 175   1          if (PIN_S1 && combHappened == combS1 && sS1)    //S1Ì§Æð£¬ÓÐ¹ýÒÔS1ÎªÖ÷¼üµÄ×éºÏ¼ü²Ù×÷£¬sS1Î´±»¸´Î»£»
 176   1          {
 177   2              combHappened = noKey;                       //½ö¸´Î»£¬ÎÞÆäËû²Ù×÷£»
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/25/2018 21:11:18 PAGE 4   

 178   2              sS1 = 0;     
 179   2          }
 180   1          else if (PIN_S2 && combHappened == combS2 && sS2)//S2Ì§Æð£¬ÓÐ¹ýÒÔS2ÎªÖ÷¼üµÄ×éºÏ¼ü²Ù×÷£¬sS2Î´±»¸´Î»£»
 181   1          {
 182   2              combHappened = noKey;                       //½ö¸´Î»£¬ÎÞÆäËû²Ù×÷£»
 183   2              sS2 = 0;     
 184   2          }
 185   1      }
 186          
 187          /* *******************************************************************************************
 188          // ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
 189          /* ******************************************************************************************* */
 190          static void checkOrdinaryKey()
 191          {
 192   1          if (combHappened == noKey)      //Ç°Ìá£ºÔÚÖ®Ç°Î´¼ì²âµ½×éºÏ°´¼ü£»
 193   1          {
 194   2              if (sS1 && PIN_S1)      //°´¼üS1ÒÑ¾­Ì§Æð²¢ÓÐ°´ÏÂ¼ÇÂ¼£»
 195   2              {
 196   3      //            TestCode();  
 197   3                  sS1 = 0;
 198   3                  combHappened = disCombS1;      
 199   3              }
 200   2              else if (sS2 && PIN_S2) //°´¼üS2ÒÑ¾­Ì§Æð²¢ÓÐ°´ÏÂ¼ÇÂ¼£»
 201   2              {
 202   3                  sS2 = 0;
 203   3                  combHappened = disCombS2;    
 204   3              }
 205   2          }
 206   1      }
 207          
 208          /* *******************************************************************************************
 209          // °´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
 210          /* ******************************************************************************************* */
 211          extern void combS1_Work();      //¶ÔÓ¦¹¦ÄÜº¯Êý£»
 212          extern void combS2_Work();
 213          extern void disCombS1_Work();
 214          extern void disCombS2_Work();
 215          
 216          static void keyCheckOver()
 217          {
 218   1          switch (combHappened)
 219   1          {
 220   2              case noKey:         //ÎÞ´¦Àí£»
 221   2                  break;
 222   2              case combS1:    combS1_Work();
 223   2                  break;
 224   2              case combS2:    combS2_Work();
 225   2                  break;
 226   2              case disCombS1: disCombS1_Work();//TestCode();  
 227   2                  break;
 228   2              case disCombS2: disCombS2_Work();
 229   2                  break;
 230   2              default:
 231   2                  break;
 232   2          }
 233   1      }
 234          
 235          /* *******************************************************************************************
 236          // CombS1¹¦ÄÜº¯Êý£»
 237          /* ******************************************************************************************* */
 238          static void combS1_Work()
 239          {
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/25/2018 21:11:18 PAGE 5   

 240   1          if (sS2 && PIN_S2)  //S2°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 241   1          {
 242   2              sS2 = 0;//ÐÞ¸ÄºóµÄ¸´Î»Î»ÖÃ£»
 243   2              LCD1602_Clear();//½öÔÚÄ£Ê½×ª»»Ê±ÇåÆÁ£»
 244   2              TestCode();  
 245   2              switch (workMode)
 246   2              {
 247   3                  case autoControl:                               //×Ô¶¯Ä£Ê½ÏÂ£¬×éºÏ¼üÎÞÐ§£»
 248   3                      break;
 249   3                  case manualControl: workMode = adjustSec;       //°´¼üÃ¿ÅÐ¶¨Ò»´Î£¬¹¤×÷Ä£Ê½ÏÂÒÆÒ»¸ö£»
 250   3                      break;
 251   3                  case adjustSec:     workMode = adjustMin;
 252   3                      break;
 253   3                  case adjustMin:     workMode = adjustHour;
 254   3                      break;
 255   3                  case adjustHour:    workMode = manualControl;  //»Ö¸´³õÊ¼×´Ì¬£»
 256   3                      break;
 257   3                  default:
 258   3                      break;
 259   3              }                   //²»Ó¦ÓÐ¸´Î»£»
 260   2          }
 261   1      }
 262          
 263          /* *******************************************************************************************
 264          // CombS2¹¦ÄÜº¯Êý£»
 265          /* ******************************************************************************************* */
 266          static void combS2_Work()
 267          {
 268   1          if (sS1 && PIN_S1)  //S1°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 269   1          {
 270   2              sS1 = 0;//ÐÞ¸ÄºóµÄ¸´Î»Î»ÖÃ£»
 271   2               LCD1602_Clear(); //½öÔÚÄ£Ê½×ª»»Ê±ÇåÆÁ£»
 272   2              switch (workMode)
 273   2              {
 274   3                  case autoControl:                               //×Ô¶¯Ä£Ê½ÏÂ£¬×éºÏ¼üÎÞÐ§£»
 275   3                      break;
 276   3                  case manualControl: workMode = adjustHumidLimit;//ÅÐ¶¨Ò»´Î£¬µ÷½ÚÄ£Ê½£»
 277   3                      break;
 278   3                  case adjustHumidLimit:workMode = manualControl; //ÅÐ¶¨Á½´Î£¬»Ö¸´Ô­Ä£Ê½£»
 279   3                      break;
 280   3                  default:
 281   3                      break;
 282   3              }                   //²»Ó¦ÓÐ¸´Î»£»
 283   2          }
 284   1      }
 285          
 286          /* *******************************************************************************************
 287          // disCombS1¹¦ÄÜº¯Êý£»
 288          /* ******************************************************************************************* */
 289          static void disCombS1_Work()
 290          {
 291   1          switch (workMode)
 292   1          {
 293   2              case autoControl:
 294   2              {
 295   3                  workMode = manualControl;  //TestCode();
 296   3                  LCD1602_Clear();                            //ÇÐ»»Ä£Ê½Ê±ÇåÆÁ£»
 297   3                  if (PIN_ConRelay == RELAY_ON)
 298   3                  {
 299   4                      PIN_ConRelay = RELAY_OFF;
 300   4                  }
 301   3                  break;
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/25/2018 21:11:18 PAGE 6   

 302   3              }
 303   2              case manualControl: workMode = autoControl; //×Ô¶¯ÊÖ¶¯Ä£Ê½ÏÂ£¬´¥·¢disCombS1£¬Á½¸öÄ£Ê½Ö®¼äÏà»¥×ª»»£
             -»
 304   2                                  LCD1602_Clear();            //ÇÐ»»Ä£Ê½Ê±ÇåÆÁ£»
 305   2                  break;
 306   2              case adjustSec:     Sec = 0;                    //Ãë¹éÁã£»
 307   2                  break;
 308   2              case adjustMin:                                 //ÆäÓà×ÔÔö£»
 309   2              {
 310   3                  if (Min < 59)
 311   3                      Min ++;
 312   3                  else
 313   3                      Min = 0;
 314   3                  break;
 315   3              }
 316   2              case adjustHour:
 317   2              {
 318   3                  if (Hour < 23)
 319   3                      Hour ++;
 320   3                  else
 321   3                      Hour = 0;
 322   3                  break;
 323   3              }
 324   2              case adjustHumidLimit:
 325   2              {
 326   3                  if (HumidLimit < HUMIDLIMIT_MAX)            //ÔÚ²»Âú×ãifÊ±£¬²»ÓèÖ´ÐÐ£»
 327   3                      HumidLimit ++;
 328   3                  break;
 329   3              }
 330   2              default:
 331   2                  break;
 332   2          }
 333   1          combHappened = noKey;       //¸´Î»£»
 334   1      }
 335          
 336          /* *******************************************************************************************
 337          // disCombS2¹¦ÄÜº¯Êý£»
 338          /* ******************************************************************************************* */
 339          static void disCombS2_Work()
 340          {
 341   1          switch (workMode)
 342   1          {
 343   2              case autoControl:                               //ÊÖ¶¯Ä£Ê½ÏÂ£¬ÎÞÐ§£»
 344   2                  break;
 345   2              case manualControl: PIN_ConRelay = !PIN_ConRelay;//×Ô¶¯Ä£Ê½ÏÂ£¬¸ü¸Ä¼ÌµçÆ÷×´Ì¬£»
 346   2                  break;
 347   2              case adjustSec:     Sec = 0;                    //Ãë¹éÁã£»
 348   2                  break;
 349   2              case adjustMin:                                 //ÆäÓà×Ô¼õ£»
 350   2              {
 351   3                  if (Min > 0)
 352   3                      Min --;
 353   3                  else
 354   3                      Min = 59;
 355   3                  break;
 356   3              }
 357   2              case adjustHour:
 358   2              {
 359   3                  if (Hour > 0)
 360   3                      Hour --;
 361   3                  else
 362   3                      Hour = 23;
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/25/2018 21:11:18 PAGE 7   

 363   3                  break;
 364   3              }
 365   2              case adjustHumidLimit:
 366   2              {
 367   3                  if (HumidLimit > HUMIDLIMIT_MIN)            //ÔÚ²»Âú×ãifÊ±£¬²»ÓèÖ´ÐÐ£»
 368   3                      HumidLimit --;
 369   3                  break;
 370   3              }
 371   2              default:
 372   2                  break;
 373   2          }
 374   1          combHappened = noKey;       //¸´Î»£»
 375   1      }
 376          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    529    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
