/* *******************************************************************************************
// Author:		biu~
// Last Date:	2017/11/03
// 公共调用函数，及部分初始化函数；
/* ******************************************************************************************* */

#include "PBDATA.H"

/*const u8 code W_Scan[8] = {0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};				//*** WARNING L16: UNCALLED SEGMENT, IGNORED FOR OVERLAY PROCESS
//const u8 code W_Scan[8] = {0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};		
const u8 code Seg_7[11] = {0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90,0xFF};	//    SEGMENT: ?CO?PBDATA，在Code区定义了数组，但没有被调用；
 */
/* *******************************************************************************************
// 延时1US，一般用于驱动中改变引脚电平状态后微量延时；
/* ******************************************************************************************* */
void Delay1US()		//@24.000MHz
{
	unsigned char i;

	_nop_();
	_nop_();
	i = 3;
	while (--i);
}

/* *******************************************************************************************
// US级延时
/* ******************************************************************************************* */
//void DelayUS(u16 x)
//{ 
//	u8 y;
//	while (x--)
//		for (y=0; y<PARAMETER_US; y++); 
//}

/* *******************************************************************************************
// MS级CPU延时
///* ******************************************************************************************* */
void DelayMS(u16 x)
{
	u16 y;
	while (x--)
		for (y=0; y<PARAMETER_MS; y++); 
}

/* *******************************************************************************************
// IO电平初始化
/* ******************************************************************************************* */
void InitIO()
{
	P0 = 0xFF;
	P0M0 = 0x00;	
	P0M1 = 0x00;	
	P1 = 0xFF;	
	P1M0 = 0x00;	
	P1M1 = 0x00;	
	P2 = 0xFF;	
	P2M0 = 0x00;	
	P2M1 = 0x00;	
	P3 = 0xFF;	
	P3M0 = 0x00;	
	P3M1 = 0x00;	
	P4 = 0xFF;	
	P4M0 = 0x00;	
	P4M1 = 0x00;	
	P5 = 0xFF;	
	P5M0 = 0x00;	
	P5M1 = 0x00;	
	P6 = 0xFF;	
	P6M0 = 0x00;	
	P6M1 = 0x00;	
	P7 = 0xFF;	
	P7M0 = 0x00;	
	P7M1 = 0x00;	
}

/* *******************************************************************************************
// 初始化完成提示
/* ******************************************************************************************* */
void InitOver()
{
	LED_On();
	DelayMS(10);
	LED_Off();
}

/* *******************************************************************************************
// 下载检测
/* ******************************************************************************************* */
// ISP区复位：
void STC_ISP()
{
	P30 = 1;
	Delay1US();
	Delay1US();
	if (!P30)
		IAP_CONTR = 0x60;
}
