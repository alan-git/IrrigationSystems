/* *******************************************************************************************
// Author:      biu~
// Last Date:   2018/03/22
// 蓝桥杯国赛驱动，添加注释；

    在一个设计里做两条I2C的人就是 Zz；
/* ******************************************************************************************* */
#include "I2C.H"

sbit I2C_SCL = P3^5;
sbit I2C_SDA = P3^4;

/* *******************************************************************************************
// I2C启动信号
/* ******************************************************************************************* */
void I2C_Start()
{
    I2C_SCL = 1;
    Delay1US();
    I2C_SDA = 1;
    Delay1US();
    I2C_SDA = 0;
    Delay1US();
    I2C_SCL = 0;
}

/* *******************************************************************************************
// I2C停止信号
/* ******************************************************************************************* */
void I2C_Stop()
{
    I2C_SCL = 0;
    Delay1US();
    I2C_SDA = 1;
    Delay1US();
    I2C_SCL = 1;
    Delay1US();
    I2C_SDA = 0;
}

/* *******************************************************************************************
// I2C应答信号
/* ******************************************************************************************* */
static bit I2C_Ack()
{
    I2C_SCL = 1;
    Delay1US();
    CY = I2C_SDA;
    I2C_SCL = 0;
    return CY;
}

/* *******************************************************************************************
// 向I2C总线发送一字节的数据
/* ******************************************************************************************* */
void I2C_Send_Byte(u8 send_data)
{
    u8 i;
    for (i=0; i<8; i++)
    {
        send_data <<= 1;
        I2C_SDA = CY;
        Delay1US();
        I2C_SCL = 1;
        Delay1US();
        I2C_SCL = 0;
        Delay1US();
    }
    I2C_Ack();
}

/* *******************************************************************************************
// 从I2C总线接收一字节的数据
/* ******************************************************************************************* */
u8 I2C_Recv_Byte()
{
    u8 i,recv_data;
    I2C_SDA = 1;            //内部拉高；
    Delay1US();
    for (i=0; i<8; i++)
    {
        recv_data <<= 1;
        I2C_SCL = 1;
        Delay1US();
        if(I2C_SDA)
            recv_data++;
        I2C_SCL = 0;
        Delay1US();
    }
    I2C_Ack();
    return recv_data;
}
