C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 15:00:44 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE KEY_WORKMODE_DISCONTROL
OBJECT MODULE PLACED IN ..\Output\Key_WorkMode_DisControl.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\Code\DeveloperCode\Key_WorkMode_DisControl.C BROWSE INCDIR(..\Code\Devel
                    -operCode\inc;..\Code\DirverCode\inc;..\Code\Public\inc) DEBUG OBJECTEXTEND PRINT(..\Listing\Key_WorkMode_DisControl.lst)
                    - OBJECT(..\Output\Key_WorkMode_DisControl.obj)

line level    source

   1          
   2          #include "Key_WorkMode_DisControl.H"
   3          
   4          bit sS1 = 0, sS2 = 0;   //°´¼üÊÇ·ñÓÐ¹ý°´ÏÂ¶¯×÷£»
   5          enum {
   6              noKey,              //ÎÞ°´¼üÊÂ¼þ£»
   7              combS1,             //ÒÔS1Ö÷°´¼üµÄ°´¼ü×éºÏÊÂ¼þ£»£¨Ö÷°´¼ü¼´±£³Ö°´ÏÂµÄ°´¼ü£©
   8              combS2,             //ÒÔS2Ö÷°´¼üµÄ°´¼ü×éºÏÊÂ¼þ£»
   9              disCombS1,          //·Ç×éºÏS1°´ÏÂÊÂ¼þ£»
  10              disCombS2,          //·Ç×éºÏS2°´ÏÂÊÂ¼þ£»
  11          }combHappened = noKey;  //°´¼ü×éºÏÊÂ¼þ·¢Éú´¦ÀíºóÖÃnoKey£»
  12          
  13          enum {
  14              autoControl,        //×Ô¶¯Ä£Ê½£»
  15              manualControl,      //ÊÖ¶¯Ä£Ê½£»
  16              adjustSec,          //µ÷½ÚÃë£»
  17              adjustMin,          //µ÷½Ú·Ö£»
  18              adjustHour,         //µ÷½ÚÊ±£»
  19              adjustHumidLimit,   //µ÷½ÚÊª¶ÈãÐÖµ£»
  20          }workMode = autoControl;//¹¤×÷Ä£Ê½Ä¬ÈÏÎª×Ô¶¯£»
  21          
  22          extern void checkPressKey();   //°´¼ü°´ÏÂ¼ì²â;
  23          extern void checkCombKey();    //°´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
  24          extern void checkOrdinaryKey();//ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
  25          extern void keyCheckOver();    //°´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
  26          
  27          /* *******************************************************************************************
  28          // ×Ô¶¯Ä£Ê½ÏÂÊª¶È¹ýµÍ×Ô¶¯¿ªÆôRelay£º
  29          /* ******************************************************************************************* */
  30          void AutoRelayControl()
  31          {
  32   1          if (workMode == autoControl)
  33   1          {
  34   2              if (Humidity <= HumidLimit)     //µ±Ç°Êª¶ÈÐ¡ÓÚÊª¶ÈãÐÖµ£»
  35   2              {
  36   3                  PIN_ConRelay = RELAY_ON;
  37   3              }
  38   2              else 
  39   2              {
  40   3                  PIN_ConRelay = RELAY_OFF;
  41   3              }
  42   2          }                                   //Relay´ò¿ª×´Ì¬ÇÐ»»Ä£Ê½Relay×Ô¶¯¹Ø±ÕµÄÓï¾äÔÚ°´¼üÏìÓ¦²¿·Ö£»  
  43   1      }
  44          
  45          /* *******************************************************************************************
  46          // ·Ç×Ô¶¯Ä£Ê½ÏÂÊª¶È¹ýµÍ·¢³ö¾¯±¨£º
  47          /* ******************************************************************************************* */
  48          void BuzzerControl()
  49          {
  50   1          if (workMode != autoControl)        //Ç°Ìá£º·Ç×Ô¶¯Ä£Ê½£»
  51   1          {
  52   2      //        TestCode();
  53   2              if (Humidity < HumidLimit)      //µ±Ç°Êª¶ÈÐ¡ÓÚÊª¶ÈãÐÖµ£»
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 15:00:44 PAGE 2   

  54   2              {
  55   3      //            TestCode();
  56   3                  if (PIN_ConRelay == RELAY_OFF)  //Ë®±ÃÎ´¿ªÆô£»
  57   3                  {
  58   4                      Buzzer_On();
  59   4                  }
  60   3                  else
  61   3                  {
  62   4                      Buzzer_Off();
  63   4                  }
  64   3              }
  65   2              else 
  66   2              {
  67   3                  Buzzer_Off();
  68   3              }
  69   2          }
  70   1          else
  71   1          {
  72   2              Buzzer_Off();
  73   2          } 
  74   1      }
  75          /* *******************************************************************************************
  76          // ÏÔÊ¾¿ØÖÆ
  77          /* ******************************************************************************************* */
  78          void DisControl()
  79          {
  80   1          switch (workMode)
  81   1          {
  82   2              case autoControl:   Dis_Auto_not_ManualMode(TRUE);
  83   2                  break;
  84   2              case manualControl: Dis_Auto_not_ManualMode(FALSE);//TestCode(); 
  85   2                  break;
  86   2              case adjustSec:     AdjustmentDataDis(SEC, Sec);
  87   2                  break;
  88   2              case adjustMin:     AdjustmentDataDis(MIN, Min);
  89   2                  break;
  90   2              case adjustHour:    AdjustmentDataDis(HOUR, Hour);
  91   2                  break;
  92   2              case adjustHumidLimit:AdjustmentDataDis(HUMIDLIMIT, HumidLimit);
  93   2                  break;
  94   2              default:
  95   2                  break;
  96   2          }
  97   1      }
  98          
  99          /* *******************************************************************************************
 100          // °´¼üÏìÓ¦
 101          /* ******************************************************************************************* */
 102          void KeyResponse()
 103          {
 104   1          checkPressKey();    //°´¼ü°´ÏÂ¼ì²â;
 105   1          checkCombKey();     //°´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
 106   1          checkOrdinaryKey(); //ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
 107   1          keyCheckOver();     //°´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
 108   1      }
 109          
 110          /* *******************************************************************************************
 111          // °´¼ü°´ÏÂ¼ì²â
 112          /* ******************************************************************************************* */
 113          static void checkPressKey()
 114          {
 115   1          if (!PIN_S1 && !sS1)    //°´¼üS1²»ÊÇ³ÖÐø°´ÏÂ£¨°´¼ü°´ÏÂµÄÒ»Ë²¼äÖ´ÐÐ£¬³ÖÐø°´ÏÂ²»»áÔÙÖ´ÐÐÏû¶¶£©£»
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 15:00:44 PAGE 3   

 116   1          {
 117   2              DelayMS(10);
 118   2              if (!PIN_S1)
 119   2              {
 120   3                  sS1 = 1;        //È·ÈÏ°´¼ü°´ÏÂ£»
 121   3              }
 122   2          }
 123   1          if (!PIN_S2 && !sS2)
 124   1          {
 125   2              DelayMS(10);
 126   2              if (!PIN_S2)
 127   2              {
 128   3                  sS2 = 1;        //È·ÈÏ°´¼ü°´ÏÂ£»  
 129   3              }
 130   2          }
 131   1      }
 132          
 133          /* *******************************************************************************************
 134          // °´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
 135          /* ******************************************************************************************* */
 136          /* ******************************************************************************************* 
 137          /* °´¼ü×´Ì¬Çî¾Ù£º
 138          /*  Ò»¡¢»ù´¡£º
 139                  1. S1°´ÏÂºóÌ§Æð£¬S2ÎÞ¶¯×÷£»
 140                  2. S2°´ÏÂºóÌ§Æð£¬S1ÎÞ¶¯×÷£»
 141              ¶þ¡¢×éºÏ£º
 142                  1. S1°´ÏÂ±£³Ö£¬S2·´¸´°´ÏÂ£»
 143                  2. S2°´ÏÂ±£³Ö£¬S1·´¸´°´ÏÂ£»
 144          ÉÏ·½ËÄÖÖÊÇÎÒÃÇÐèÒªµÄ£¬Ê¶±ðºóµ÷ÓÃ¹¦ÄÜº¯Êý
 145          ÏÂ·½ËÄÖÖ(ºÜ¶àÖÖ)²»ÐèÒª£¬Ê¶±ðºóÂËÈ¥£»
 146                  3. S1°´ÏÂ£¬S2°´ÏÂ£¬S1Ì§Æð£¬S2Ì§Æð£»
 147                  4. S2°´ÏÂ£¬S1°´ÏÂ£¬S2Ì§Æð£¬S1Ì§Æð£»
 148                  5. S1°´ÏÂ£¬S2°´ÏÂ±£³Ö£¬S1·´¸´Ì§Æð°´ÏÂ£»
 149                  6. S2°´ÏÂ£¬S1°´ÏÂ±£³Ö£¬S2·´¸´Ì§Æð°´ÏÂ£»
 150          /* ******************************************************************************************* */
 151          static void checkCombKey()
 152          {
 153   1          if (!PIN_S1)            //¼´Ä¿Ç°S1´¦ÓÚ°´ÏÂ×´Ì¬£»
 154   1          {
 155   2              if (sS2 && PIN_S2)  //S2°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 156   2              {
 157   3      //            sS2 = 0;//¸´Î»Î»ÖÃ´íÎó£¬ÒÑÐÞ¸Ä£»
 158   3                  combHappened = combS1;
 159   3              }
 160   2          }
 161   1          if (!PIN_S2)            //¼´Ä¿Ç°S2´¦ÓÚ°´ÏÂ×´Ì¬£»
 162   1          {
 163   2              if (sS1 && PIN_S1)  //S1°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 164   2              {
 165   3      //            sS1 = 0;//¸´Î»Î»ÖÃ´íÎó£¬ÒÑÐÞ¸Ä£»
 166   3                  combHappened = combS2;
 167   3              }
 168   2          }
 169   1      // ÏÂ·½º¯Êý²»ÄÜÓëÉÏ·½º¯ÊýÎ»ÖÃ¶Ôµ÷£»
 170   1          if (PIN_S1 && combHappened == combS1 && sS1)    //S1Ì§Æð£¬ÓÐ¹ýÒÔS1ÎªÖ÷¼üµÄ×éºÏ¼ü²Ù×÷£¬sS1Î´±»¸´Î»£»
 171   1          {
 172   2              combHappened = noKey;                       //½ö¸´Î»£¬ÎÞÆäËû²Ù×÷£»
 173   2              sS1 = 0;     
 174   2          }
 175   1          else if (PIN_S2 && combHappened == combS2 && sS2)//S2Ì§Æð£¬ÓÐ¹ýÒÔS2ÎªÖ÷¼üµÄ×éºÏ¼ü²Ù×÷£¬sS2Î´±»¸´Î»£»
 176   1          {
 177   2              combHappened = noKey;                       //½ö¸´Î»£¬ÎÞÆäËû²Ù×÷£»
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 15:00:44 PAGE 4   

 178   2              sS2 = 0;     
 179   2          }
 180   1      }
 181          
 182          /* *******************************************************************************************
 183          // ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
 184          /* ******************************************************************************************* */
 185          static void checkOrdinaryKey()
 186          {
 187   1          if (combHappened == noKey)      //Ç°Ìá£ºÔÚÖ®Ç°Î´¼ì²âµ½×éºÏ°´¼ü£»
 188   1          {
 189   2              if (sS1 && PIN_S1)      //°´¼üS1ÒÑ¾­Ì§Æð²¢ÓÐ°´ÏÂ¼ÇÂ¼£»
 190   2              {
 191   3      //            TestCode();  
 192   3                  sS1 = 0;
 193   3                  combHappened = disCombS1;      
 194   3              }
 195   2              else if (sS2 && PIN_S2) //°´¼üS2ÒÑ¾­Ì§Æð²¢ÓÐ°´ÏÂ¼ÇÂ¼£»
 196   2              {
 197   3                  sS2 = 0;
 198   3                  combHappened = disCombS2;    
 199   3              }
 200   2          }
 201   1      }
 202          
 203          /* *******************************************************************************************
 204          // °´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
 205          /* ******************************************************************************************* */
 206          extern void combS1_Work();      //¶ÔÓ¦¹¦ÄÜº¯Êý£»
 207          extern void combS2_Work();
 208          extern void disCombS1_Work();
 209          extern void disCombS2_Work();
 210          
 211          static void keyCheckOver()
 212          {
 213   1          switch (combHappened)
 214   1          {
 215   2              case noKey:         //ÎÞ´¦Àí£»
 216   2                  break;
 217   2              case combS1:    combS1_Work();
 218   2                  break;
 219   2              case combS2:    combS2_Work();
 220   2                  break;
 221   2              case disCombS1: disCombS1_Work();//TestCode();  
 222   2                  break;
 223   2              case disCombS2: disCombS2_Work();
 224   2                  break;
 225   2              default:
 226   2                  break;
 227   2          }
 228   1      }
 229          
 230          /* *******************************************************************************************
 231          // CombS1¹¦ÄÜº¯Êý£»
 232          /* ******************************************************************************************* */
 233          static void combS1_Work()
 234          {
 235   1          if (sS2 && PIN_S2)  //S2°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 236   1          {
 237   2              sS2 = 0;//ÐÞ¸ÄºóµÄ¸´Î»Î»ÖÃ£»
 238   2              TestCode();  
 239   2              switch (workMode)
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 15:00:44 PAGE 5   

 240   2              {
 241   3                  case autoControl:                               //×Ô¶¯Ä£Ê½ÏÂ£¬×éºÏ¼üÎÞÐ§£»
 242   3                      break;
 243   3                  case manualControl: workMode = adjustSec;       //°´¼üÃ¿ÅÐ¶¨Ò»´Î£¬¹¤×÷Ä£Ê½ÏÂÒÆÒ»¸ö£»
 244   3                      break;
 245   3                  case adjustSec:     workMode = adjustMin;
 246   3                      break;
 247   3                  case adjustMin:     workMode = adjustHour;
 248   3                      break;
 249   3                  case adjustHour:    workMode = manualControl;  //»Ö¸´³õÊ¼×´Ì¬£»
 250   3                      break;
 251   3                  default:
 252   3                      break;
 253   3              }                   //²»Ó¦ÓÐ¸´Î»£»
 254   2          }
 255   1      }
 256          
 257          /* *******************************************************************************************
 258          // CombS2¹¦ÄÜº¯Êý£»
 259          /* ******************************************************************************************* */
 260          static void combS2_Work()
 261          {
 262   1          if (sS1 && PIN_S1)  //S1°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 263   1          {
 264   2              sS1 = 0;//ÐÞ¸ÄºóµÄ¸´Î»Î»ÖÃ£»
 265   2              switch (workMode)
 266   2              {
 267   3                  case autoControl:                               //×Ô¶¯Ä£Ê½ÏÂ£¬×éºÏ¼üÎÞÐ§£»
 268   3                      break;
 269   3                  case manualControl: workMode = adjustHumidLimit;//ÅÐ¶¨Ò»´Î£¬µ÷½ÚÄ£Ê½£»
 270   3                      break;
 271   3                  case adjustHumidLimit:workMode = manualControl; //ÅÐ¶¨Á½´Î£¬»Ö¸´Ô­Ä£Ê½£»
 272   3                      break;
 273   3                  default:
 274   3                      break;
 275   3              }                   //²»Ó¦ÓÐ¸´Î»£»
 276   2          }
 277   1      }
 278          
 279          /* *******************************************************************************************
 280          // disCombS1¹¦ÄÜº¯Êý£»
 281          /* ******************************************************************************************* */
 282          static void disCombS1_Work()
 283          {
 284   1          switch (workMode)
 285   1          {
 286   2              case autoControl:
 287   2              {
 288   3                 workMode = manualControl;//TestCode();
 289   3                  if (PIN_ConRelay == RELAY_ON)
 290   3                  {
 291   4                      PIN_ConRelay = RELAY_OFF;
 292   4                  }
 293   3                  break;
 294   3              }
 295   2              case manualControl: workMode = autoControl; //×Ô¶¯ÊÖ¶¯Ä£Ê½ÏÂ£¬´¥·¢disCombS1£¬Á½¸öÄ£Ê½Ö®¼äÏà»¥×ª»»£
             -»
 296   2                  break;
 297   2              case adjustSec:     Sec = 0;                    //Ãë¹éÁã£»
 298   2                  break;
 299   2              case adjustMin:                                 //ÆäÓà×ÔÔö£»
 300   2              {
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 15:00:44 PAGE 6   

 301   3                  if (Min < 59)
 302   3                      Min ++;
 303   3                  else
 304   3                      Min = 0;
 305   3                  break;
 306   3              }
 307   2              case adjustHour:
 308   2              {
 309   3                  if (Hour < 23)
 310   3                      Hour ++;
 311   3                  else
 312   3                      Hour = 0;
 313   3                  break;
 314   3              }
 315   2              case adjustHumidLimit:
 316   2              {
 317   3                  if (HumidLimit < HUMIDLIMIT_MAX)            //ÔÚ²»Âú×ãifÊ±£¬²»ÓèÖ´ÐÐ£»
 318   3                      HumidLimit ++;
 319   3                  break;
 320   3              }
 321   2              default:
 322   2                  break;
 323   2          }
 324   1          combHappened = noKey;       //¸´Î»£»
 325   1      }
 326          
 327          /* *******************************************************************************************
 328          // disCombS2¹¦ÄÜº¯Êý£»
 329          /* ******************************************************************************************* */
 330          static void disCombS2_Work()
 331          {
 332   1          switch (workMode)
 333   1          {
 334   2              case autoControl:                                //ÊÖ¶¯Ä£Ê½ÏÂ£¬ÎÞÐ§£»
 335   2                  break;
 336   2              case manualControl: PIN_ConRelay = !PIN_ConRelay;//×Ô¶¯Ä£Ê½ÏÂ£¬¸ü¸Ä¼ÌµçÆ÷×´Ì¬£»
 337   2                  break;
 338   2              case adjustSec:     Sec = 0;                    //Ãë¹éÁã£»
 339   2                  break;
 340   2              case adjustMin:                                 //ÆäÓà×Ô¼õ£»
 341   2              {
 342   3                  if (Min > 0)
 343   3                      Min --;
 344   3                  else
 345   3                      Min = 59;
 346   3                  break;
 347   3              }
 348   2              case adjustHour:
 349   2              {
 350   3                  if (Hour > 0)
 351   3                      Hour --;
 352   3                  else
 353   3                      Hour = 23;
 354   3                  break;
 355   3              }
 356   2              case adjustHumidLimit:
 357   2              {
 358   3                  if (HumidLimit > HUMIDLIMIT_MIN)            //ÔÚ²»Âú×ãifÊ±£¬²»ÓèÖ´ÐÐ£»
 359   3                      HumidLimit --;
 360   3                  break;
 361   3              }
 362   2              default:
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 15:00:44 PAGE 7   

 363   2                  break;
 364   2          }
 365   1          combHappened = noKey;       //¸´Î»£»
 366   1      }
 367          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    517    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
