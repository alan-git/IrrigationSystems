C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 11:29:26 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE KEY_WORKMODE_DISCONTROL
OBJECT MODULE PLACED IN ..\Output\Key_WorkMode_DisControl.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\Code\DeveloperCode\Key_WorkMode_DisControl.C BROWSE INCDIR(..\Code\Devel
                    -operCode\inc;..\Code\DirverCode\inc;..\Code\Public\inc) DEBUG OBJECTEXTEND PRINT(..\Listing\Key_WorkMode_DisControl.lst)
                    - OBJECT(..\Output\Key_WorkMode_DisControl.obj)

line level    source

   1          
   2          #include "Key_WorkMode_DisControl.H"
   3          
   4          bit sS1 = 0, sS2 = 0;   //°´¼üÊÇ·ñÓÐ¹ý°´ÏÂ¶¯×÷£»
   5          enum {
   6              noKey,              //ÎÞ°´¼üÊÂ¼þ£»
   7              combS1,             //ÒÔS1Ö÷°´¼üµÄ°´¼ü×éºÏÊÂ¼þ£»£¨Ö÷°´¼ü¼´±£³Ö°´ÏÂµÄ°´¼ü£©
   8              combS2,             //ÒÔS2Ö÷°´¼üµÄ°´¼ü×éºÏÊÂ¼þ£»
   9              disCombS1,          //·Ç×éºÏS1°´ÏÂÊÂ¼þ£»
  10              disCombS2,          //·Ç×éºÏS2°´ÏÂÊÂ¼þ£»
  11          }combHappened = noKey;  //°´¼ü×éºÏÊÂ¼þ·¢Éú´¦ÀíºóÖÃnoKey£»
  12          
  13          enum {
  14              autoControl,        //×Ô¶¯Ä£Ê½£»
  15              manualControl,      //ÊÖ¶¯Ä£Ê½£»
  16              adjustSec,          //µ÷½ÚÃë£»
  17              adjustMin,          //µ÷½Ú·Ö£»
  18              adjustHour,         //µ÷½ÚÊ±£»
  19              adjustHumidLimit,   //µ÷½ÚÊª¶ÈãÐÖµ£»
  20          }workMode = autoControl;//¹¤×÷Ä£Ê½Ä¬ÈÏÎª×Ô¶¯£»
  21          
  22          extern void checkPressKey();   //°´¼ü°´ÏÂ¼ì²â;
  23          extern void checkCombKey();    //°´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
  24          extern void checkOrdinaryKey();//ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
  25          extern void keyCheckOver();    //°´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
  26          
  27          /* *******************************************************************************************
  28          // ·Ç×Ô¶¯Ä£Ê½ÏÂÊª¶È¹ýµÍ·¢³ö¾¯±¨£º
  29          /* ******************************************************************************************* */
  30          void BuzzerControl()
  31          {
  32   1          if (workMode != autoControl)        //Ç°Ìá£º·Ç×Ô¶¯Ä£Ê½£»
  33   1          {
  34   2      //        TestCode();
  35   2              if (Humidity < HumidLimit)      //µ±Ç°Êª¶ÈÐ¡ÓÚÊª¶ÈãÐÖµ£»
  36   2              {
  37   3      //            TestCode();
  38   3                  Buzzer_On();
  39   3              }
  40   2              else 
  41   2              {
  42   3                  Buzzer_Off();
  43   3              }
  44   2          }
  45   1          else
  46   1          {
  47   2              Buzzer_Off();
  48   2          } 
  49   1      }
  50          /* *******************************************************************************************
  51          // ÏÔÊ¾¿ØÖÆ
  52          /* ******************************************************************************************* */
  53          void DisControl()
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 11:29:26 PAGE 2   

  54          {
  55   1          switch (workMode)
  56   1          {
  57   2              case autoControl:   Dis_Auto_not_ManualMode(TRUE);
  58   2                  break;
  59   2              case manualControl: Dis_Auto_not_ManualMode(FALSE);//TestCode(); 
  60   2                  break;
  61   2              case adjustSec:     AdjustmentDataDis(SEC, Sec);
  62   2                  break;
  63   2              case adjustMin:     AdjustmentDataDis(MIN, Min);
  64   2                  break;
  65   2              case adjustHour:    AdjustmentDataDis(HOUR, Hour);
  66   2                  break;
  67   2              case adjustHumidLimit:AdjustmentDataDis(HUMIDLIMIT, HumidLimit);
  68   2                  break;
  69   2              default:
  70   2                  break;
  71   2          }
  72   1      }
  73          
  74          /* *******************************************************************************************
  75          // °´¼üÏìÓ¦
  76          /* ******************************************************************************************* */
  77          void KeyResponse()
  78          {
  79   1          checkPressKey();    //°´¼ü°´ÏÂ¼ì²â;
  80   1          checkCombKey();     //°´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
  81   1          checkOrdinaryKey(); //ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
  82   1          keyCheckOver();     //°´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
  83   1      }
  84          
  85          /* *******************************************************************************************
  86          // °´¼ü°´ÏÂ¼ì²â
  87          /* ******************************************************************************************* */
  88          static void checkPressKey()
  89          {
  90   1          if (!PIN_S1 && !sS1)    //°´¼üS1²»ÊÇ³ÖÐø°´ÏÂ£¨°´¼ü°´ÏÂµÄÒ»Ë²¼äÖ´ÐÐ£¬³ÖÐø°´ÏÂ²»»áÔÙÖ´ÐÐÏû¶¶£©£»
  91   1          {
  92   2              DelayMS(10);
  93   2              if (!PIN_S1)
  94   2              {
  95   3                  sS1 = 1;        //È·ÈÏ°´¼ü°´ÏÂ£»
  96   3              }
  97   2          }
  98   1          if (!PIN_S2 && !sS2)
  99   1          {
 100   2              DelayMS(10);
 101   2              if (!PIN_S2)
 102   2              {
 103   3                  sS2 = 1;        //È·ÈÏ°´¼ü°´ÏÂ£»  
 104   3              }
 105   2          }
 106   1      }
 107          
 108          /* *******************************************************************************************
 109          // °´¼ü×éºÏ¼ì²â£¬ÔÚcheckPressKey()ºóµ÷ÓÃ£»
 110          /* ******************************************************************************************* */
 111          /* ******************************************************************************************* 
 112          /* °´¼ü×´Ì¬Çî¾Ù£º
 113          /*  Ò»¡¢»ù´¡£º
 114                  1. S1°´ÏÂºóÌ§Æð£¬S2ÎÞ¶¯×÷£»
 115                  2. S2°´ÏÂºóÌ§Æð£¬S1ÎÞ¶¯×÷£»
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 11:29:26 PAGE 3   

 116              ¶þ¡¢×éºÏ£º
 117                  1. S1°´ÏÂ±£³Ö£¬S2·´¸´°´ÏÂ£»
 118                  2. S2°´ÏÂ±£³Ö£¬S1·´¸´°´ÏÂ£»
 119          ÉÏ·½ËÄÖÖÊÇÎÒÃÇÐèÒªµÄ£¬Ê¶±ðºóµ÷ÓÃ¹¦ÄÜº¯Êý
 120          ÏÂ·½ËÄÖÖ(ºÜ¶àÖÖ)²»ÐèÒª£¬Ê¶±ðºóÂËÈ¥£»
 121                  3. S1°´ÏÂ£¬S2°´ÏÂ£¬S1Ì§Æð£¬S2Ì§Æð£»
 122                  4. S2°´ÏÂ£¬S1°´ÏÂ£¬S2Ì§Æð£¬S1Ì§Æð£»
 123                  5. S1°´ÏÂ£¬S2°´ÏÂ±£³Ö£¬S1·´¸´Ì§Æð°´ÏÂ£»
 124                  6. S2°´ÏÂ£¬S1°´ÏÂ±£³Ö£¬S2·´¸´Ì§Æð°´ÏÂ£»
 125          /* ******************************************************************************************* */
 126          static void checkCombKey()
 127          {
 128   1          if (!PIN_S1)            //¼´Ä¿Ç°S1´¦ÓÚ°´ÏÂ×´Ì¬£»
 129   1          {
 130   2              if (sS2 && PIN_S2)  //S2°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 131   2              {
 132   3      //            sS2 = 0;//¸´Î»Î»ÖÃ´íÎó£¬ÒÑÐÞ¸Ä£»
 133   3                  combHappened = combS1;
 134   3              }
 135   2          }
 136   1          if (!PIN_S2)            //¼´Ä¿Ç°S2´¦ÓÚ°´ÏÂ×´Ì¬£»
 137   1          {
 138   2              if (sS1 && PIN_S1)  //S1°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 139   2              {
 140   3      //            sS1 = 0;//¸´Î»Î»ÖÃ´íÎó£¬ÒÑÐÞ¸Ä£»
 141   3                  combHappened = combS2;
 142   3              }
 143   2          }
 144   1      // ÏÂ·½º¯Êý²»ÄÜÓëÉÏ·½º¯ÊýÎ»ÖÃ¶Ôµ÷£»
 145   1          if (PIN_S1 && combHappened == combS1 && sS1)    //S1Ì§Æð£¬ÓÐ¹ýÒÔS1ÎªÖ÷¼üµÄ×éºÏ¼ü²Ù×÷£¬sS1Î´±»¸´Î»£»
 146   1          {
 147   2              combHappened = noKey;                       //½ö¸´Î»£¬ÎÞÆäËû²Ù×÷£»
 148   2              sS1 = 0;     
 149   2          }
 150   1          else if (PIN_S2 && combHappened == combS2 && sS2)//S2Ì§Æð£¬ÓÐ¹ýÒÔS2ÎªÖ÷¼üµÄ×éºÏ¼ü²Ù×÷£¬sS2Î´±»¸´Î»£»
 151   1          {
 152   2              combHappened = noKey;                       //½ö¸´Î»£¬ÎÞÆäËû²Ù×÷£»
 153   2              sS2 = 0;     
 154   2          }
 155   1      }
 156          
 157          /* *******************************************************************************************
 158          // ÆÕÍ¨°´¼ü¼ì²â£¬ÔÚcheckCombKey()ºóµ÷ÓÃ£»
 159          /* ******************************************************************************************* */
 160          static void checkOrdinaryKey()
 161          {
 162   1          if (combHappened == noKey)      //Ç°Ìá£ºÔÚÖ®Ç°Î´¼ì²âµ½×éºÏ°´¼ü£»
 163   1          {
 164   2              if (sS1 && PIN_S1)      //°´¼üS1ÒÑ¾­Ì§Æð²¢ÓÐ°´ÏÂ¼ÇÂ¼£»
 165   2              {
 166   3      //            TestCode();  
 167   3                  sS1 = 0;
 168   3                  combHappened = disCombS1;      
 169   3              }
 170   2              else if (sS2 && PIN_S2) //°´¼üS2ÒÑ¾­Ì§Æð²¢ÓÐ°´ÏÂ¼ÇÂ¼£»
 171   2              {
 172   3                  sS2 = 0;
 173   3                  combHappened = disCombS2;    
 174   3              }
 175   2          }
 176   1      }
 177          
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 11:29:26 PAGE 4   

 178          /* *******************************************************************************************
 179          // °´¼ü¼ì²âÍê±ÏÏìÓ¦£¬ÔÚcheckOrdinaryKey()ºóµ÷ÓÃ£»
 180          /* ******************************************************************************************* */
 181          extern void combS1_Work();      //¶ÔÓ¦¹¦ÄÜº¯Êý£»
 182          extern void combS2_Work();
 183          extern void disCombS1_Work();
 184          extern void disCombS2_Work();
 185          
 186          static void keyCheckOver()
 187          {
 188   1          switch (combHappened)
 189   1          {
 190   2              case noKey:         //ÎÞ´¦Àí£»
 191   2                  break;
 192   2              case combS1:    combS1_Work();
 193   2                  break;
 194   2              case combS2:    combS2_Work();
 195   2                  break;
 196   2              case disCombS1: disCombS1_Work();//TestCode();  
 197   2                  break;
 198   2              case disCombS2: disCombS2_Work();
 199   2                  break;
 200   2              default:
 201   2                  break;
 202   2          }
 203   1      }
 204          
 205          /* *******************************************************************************************
 206          // CombS1¹¦ÄÜº¯Êý£»
 207          /* ******************************************************************************************* */
 208          static void combS1_Work()
 209          {
 210   1          if (sS2 && PIN_S2)  //S2°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 211   1          {
 212   2              sS2 = 0;//ÐÞ¸ÄºóµÄ¸´Î»Î»ÖÃ£»
 213   2              TestCode();  
 214   2              switch (workMode)
 215   2              {
 216   3                  case autoControl:                               //×Ô¶¯Ä£Ê½ÏÂ£¬×éºÏ¼üÎÞÐ§£»
 217   3                      break;
 218   3                  case manualControl: workMode = adjustSec;       //°´¼üÃ¿ÅÐ¶¨Ò»´Î£¬¹¤×÷Ä£Ê½ÏÂÒÆÒ»¸ö£»
 219   3                      break;
 220   3                  case adjustSec:     workMode = adjustMin;
 221   3                      break;
 222   3                  case adjustMin:     workMode = adjustHour;
 223   3                      break;
 224   3                  case adjustHour:    workMode = manualControl;  //»Ö¸´³õÊ¼×´Ì¬£»
 225   3                      break;
 226   3                  default:
 227   3                      break;
 228   3              }                   //²»Ó¦ÓÐ¸´Î»£»
 229   2          }
 230   1      }
 231          
 232          /* *******************************************************************************************
 233          // CombS2¹¦ÄÜº¯Êý£»
 234          /* ******************************************************************************************* */
 235          static void combS2_Work()
 236          {
 237   1          if (sS1 && PIN_S1)  //S1°´ÏÂ¹ý£¬²¢ÇÒÄ¿Ç°´¦ÓÚÌ§Æð×´Ì¬£»
 238   1          {
 239   2              sS1 = 0;//ÐÞ¸ÄºóµÄ¸´Î»Î»ÖÃ£»
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 11:29:26 PAGE 5   

 240   2              switch (workMode)
 241   2              {
 242   3                  case autoControl:                               //×Ô¶¯Ä£Ê½ÏÂ£¬×éºÏ¼üÎÞÐ§£»
 243   3                      break;
 244   3                  case manualControl: workMode = adjustHumidLimit;//ÅÐ¶¨Ò»´Î£¬µ÷½ÚÄ£Ê½£»
 245   3                      break;
 246   3                  case adjustHumidLimit:workMode = manualControl; //ÅÐ¶¨Á½´Î£¬»Ö¸´Ô­Ä£Ê½£»
 247   3                      break;
 248   3                  default:
 249   3                      break;
 250   3              }                   //²»Ó¦ÓÐ¸´Î»£»
 251   2          }
 252   1      }
 253          
 254          /* *******************************************************************************************
 255          // disCombS1¹¦ÄÜº¯Êý£»
 256          /* ******************************************************************************************* */
 257          static void disCombS1_Work()
 258          {
 259   1          switch (workMode)
 260   1          {
 261   2              case autoControl:   workMode = manualControl;//TestCode();
 262   2                  break;
 263   2              case manualControl: workMode = autoControl; //×Ô¶¯ÊÖ¶¯Ä£Ê½ÏÂ£¬´¥·¢disCombS1£¬Á½¸öÄ£Ê½Ö®¼äÏà»¥×ª»»£
             -»
 264   2                  break;
 265   2              case adjustSec:     Sec = 0;                    //Ãë¹éÁã£»
 266   2                  break;
 267   2              case adjustMin:                                 //ÆäÓà×ÔÔö£»
 268   2              {
 269   3                  if (Min < 59)
 270   3                      Min ++;
 271   3                  else
 272   3                      Min = 0;
 273   3                  break;
 274   3              }
 275   2              case adjustHour:
 276   2              {
 277   3                  if (Hour < 23)
 278   3                      Hour ++;
 279   3                  else
 280   3                      Hour = 0;
 281   3                  break;
 282   3              }
 283   2              case adjustHumidLimit:
 284   2              {
 285   3                  if (HumidLimit < HUMIDLIMIT_MAX)            //ÔÚ²»Âú×ãifÊ±£¬²»ÓèÖ´ÐÐ£»
 286   3                      HumidLimit ++;
 287   3                  break;
 288   3              }
 289   2              default:
 290   2                  break;
 291   2          }
 292   1          combHappened = noKey;       //¸´Î»£»
 293   1      }
 294          
 295          /* *******************************************************************************************
 296          // disCombS2¹¦ÄÜº¯Êý£»
 297          /* ******************************************************************************************* */
 298          static void disCombS2_Work()
 299          {
 300   1          switch (workMode)
C51 COMPILER V9.02   KEY_WORKMODE_DISCONTROL                                               03/24/2018 11:29:26 PAGE 6   

 301   1          {
 302   2              case autoControl:                                //ÊÖ¶¯Ä£Ê½ÏÂ£¬ÎÞÐ§£»
 303   2                  break;
 304   2              case manualControl: PIN_ConRelay = !PIN_ConRelay;//×Ô¶¯Ä£Ê½ÏÂ£¬¸ü¸Ä¼ÌµçÆ÷×´Ì¬£»
 305   2                  break;
 306   2              case adjustSec:     Sec = 0;                    //Ãë¹éÁã£»
 307   2                  break;
 308   2              case adjustMin:                                 //ÆäÓà×Ô¼õ£»
 309   2              {
 310   3                  if (Min > 0)
 311   3                      Min --;
 312   3                  else
 313   3                      Min = 59;
 314   3                  break;
 315   3              }
 316   2              case adjustHour:
 317   2              {
 318   3                  if (Hour > 0)
 319   3                      Hour --;
 320   3                  else
 321   3                      Hour = 23;
 322   3                  break;
 323   3              }
 324   2              case adjustHumidLimit:
 325   2              {
 326   3                  if (HumidLimit > HUMIDLIMIT_MIN)            //ÔÚ²»Âú×ãifÊ±£¬²»ÓèÖ´ÐÐ£»
 327   3                      HumidLimit --;
 328   3                  break;
 329   3              }
 330   2              default:
 331   2                  break;
 332   2          }
 333   1          combHappened = noKey;       //¸´Î»£»
 334   1      }
 335          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    489    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
